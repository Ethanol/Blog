---
layout: post
title: NoSQL数据建模技术
categories:
- NoSQL
---
本文节译自[NoSQL Data Modeling Techniques](http://highlyscalable.wordpress.com/2012/03/01/nosql-data-modeling-techniques/)。

##NoSQL数据建模中的一般问题##

作为前言，首先提出一些NoSQL建模中的一般化问题：

* 与关系建模不同，NoSQL数据建模通常从应用程序查询的角度来建模：
    * 关系建模的方式通常是由数据的结构来决定的，设计的主题是：“我能回答什么问题？”
    * NoSQL建模的方式则是由数据访问方式决定（例如要支持哪些查询），设计的主题是：“我能提出什么问题？”
* NoSQL建模通常需要对数据结构和算法有更深的理解。本文中，我们将探讨一些虽然不是针对NoSQL，但是在NoSQL中很实用的数据结构。
* 数据的冗余和反范式化是很重要的。

尽管数据建模技术是没有定式的，但对于特定的系统来说，本文将给出一些思路。

##概念性技术##

1. 反范式化

反范式化可以被定义为多个文档/表拥有相同的数据副本，以使查询处理变得更简单高效。

2. 聚集

主流的NoSQL数据库均对模式（schema）没有很强的限制：

* Key-Value存储通常不对存储的值有约束，因此值可以是任意的格式。此外，一个业务实体也可以占用多条记录。例如，用户账户可以这样建模：以*UserID_name*, *UserID_email*这样的名称作为key。
* 文档型数据库通常则是固有的schema-less。

这样的设计允许实用复杂的内部结构来构建实体，主要包括两方面：

* 最小化一对多的关系（通过嵌套实体），这样，就会减少连接操作。
* 隐藏了异构的业务实体间的不同。

我们可以用如下这张图来展示。这副图对产品实体进行了建模。首先，我们说，所有的产品都有ID，价格和描述。接下来，我们发现不同类型的产品拥有不同的属性，例如书籍的作者和裤子的长度。有些属性是一对多或者多对多的，例如唱片中的曲目等。接下来，我们发现，有些实体难以用固定的属性建模，例如裤子的属性取决于品牌。虽然在关系数据库中，这些模型都是能建出来的，但显然不如NoSQL简洁。

<img src="/images/soft-schema2.png" style="width: 550px;"/>

3. 应用程序端连接

NoSQL解决方案中几乎不支持连接。作为“问题驱动”的NoSQL设计，连接通常在设计时就被考虑好了，使用之前描述的反范式化和聚集就可以解决这个问题。当然，有些时候，连接还是无法避免，此时应该由应用程序处理。

##一般建模技术##

未完待续
